\section{Programming the nRF51-dongle}
\textit{This section covers the programming of the nRF51-server dongle. For information about the nRF51-peripherals, see Ese (2016).}

\minisection{Dependencies}
\label{sec:nrfrequirements}
To program the nRF51-dongles, the following software has to be downloaded and installed:
\begin{itemize}
    \item nRF51 SDK10\cite{nrf51sdk}
    \item nRFgo Studio v1.21\cite{nrfgo}
    \item Keil MDK-ARM v5.20\cite{keil}
\end{itemize}
Drivers for nRF51-dongle comes with nRFgo Studio, it is recommended to install the drivers from nRFgo Studio before plugging in the nRF51 dongle since Windows will try to use Windows Update to search for the drivers, as Windows does not find the correct drivers it will scan indefinitely.

\minisection{Setting up the nRF51-dongle}
Having installed all the software listed in Section \ref{sec:nrfrequirements}, the following procedure has to be followed to flash the dongle and prepare it for programming:
\begin{enumerate}
    \item Plug in the nRF51-dongle to one of the external USB-ports at the computer.
    \item Start nRFgo Studio, and choose the desired device in the ``Device Manager''-list.
    \item Click ``Erase all''.
    \item Choose the ``Program SoftDevice''-pane in the right panel and click ``Browse...''.
    \item Navigate to ``[yourDestination]/nrf51\_sdk10/components/softdevice/s130/hex'' and choose the ``s130\_nrf51\_x.x.x\_softdevice''.
    \item Click ``Program''.
\end{enumerate}

\section{Developing the nRF51-server software}
The nRF51-server should be able to communicate with several nRF51-peripherals. It has to provide functionality for sending messages to the connected peripherals and receiving messages from other connected peripherals at the same time. Since the server and peripherals are tightly coupled, the software on the dongles was developed together with Ese (2016).

Nordic Semiconductor, the manufacturer of the dongle, has some sample code for communication between two dongles, but this sample code can not be used when several dongles are connected at the same time. There is also another sample code with peripherals and central (server), however in this code, the communication can only go one way. Marco Russi has modified Nordics central program to have communication both ways \cite{marcoRussi}. There was a meeting 12th of February together with Andersen, Ese and Nordic Semiconductor where the agenda was to get a briefing on how Nordics peripheral- and central-code works, more information about the nRF51-dongle and some investigation in Marco Russis code.

The nRF51-server software is a modified version of Marcos central-software, which again is just a modified version of Nordics central software. Whenever the server dongle gets a message it gets forwarded to the computers \acrshort{com}-port, the message has the structure ``nrf[robotID]:Message'' where robotID is an ID the dongle generates for each connected peripheral and Message is the message received through Bluetooth. Because of limitation in Bluetooth the message size has a cap of 20bytes, if a robot sends a message longer than 20bytes it gets split into several packages. As of right now the robot can send messages up to 60bytes, resulting in maximum three packages per message. If more than one robot tries to send messages at the same time, it is possible that the packages get intertwined alternately. e.g. Robot 1 says \code{Hello beautiful World} and Robot 2 says \code{Hello} the result read from the computer \acrshort{com}-port could be: \code{nrf[1]:R1:\{Hello beautiful Worlnrf[2]:R2:\{Hello\}\textbackslash nnrf[1]:d\}\textbackslash n}

The untwining of the messages happens in the Java applications Communication package, see \ref{secr:structure}. The messages from the peripheral should be embraced with curly brackets, end with a linebreak and the messages can not contain a colon or square brackets. By fulfilling these requirements, the messages can be untwined successfully.

The biggest limitation in the nRF51-server software is that it is not possible to connect more than six robots since the central can maximum hold six Bluetooth connections at the same time.

\task{må nok gjøre litt om på layouten her}